{% extends 'html/command_center_base.html' %}
{% load static %}
{% block content %}
    <!-- Title -->
    <div class="row heading-bg">
        <div class="col-lg-3 col-md-4 col-sm-4 col-xs-12">
            <h5 class="txt-dark">Archives</h5>
        </div>
        <!-- Breadcrumb -->
        <div class="col-lg-9 col-sm-8 col-md-8 col-xs-12">
            <ol class="breadcrumb">
                <li><a href="{% url 'dashboard' %}">Dashboard</a></li>
                <li class="active"><span>Archive</span></li>
            </ol>
        </div>
        <!-- /Breadcrumb -->
    </div>
    <!-- /Title -->
    <!-- Row -->
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default card-view pa-0">
                <div class="panel-wrapper collapse in">
                    <div class="panel-body pa-0">
                        <div class="contact-list">
                            <div class="row">
                                <aside class="col-lg-2 col-md-4 pr-0">
                                    <ul class="inbox-nav mb-30">
                                        <li id="Emp">
                                            <a href="#" class="Emp">Employees <span
                                                    class="label label-primary ml-10">{{ nums.0 }}</span></a>
                                        </li>
                                        <li id="Worker">
                                            <a href="#">Workers <span
                                                    class="label label-danger ml-10">{{ nums.1 }}</span></a>
                                        </li>
                                        <li id="Truck">
                                            <a href="#">Trucks <span
                                                    class="label label-warning ml-10">{{ nums.2 }}</span></a>
                                        </li>
                                        <li id="User">
                                            <a href="#">Users<span
                                                    class="label label-info ml-10">{{ nums.3 }}</span></a>
                                        </li>

                                        <li id="QR">
                                            <a href="#"> QR codes<span
                                                    class="label label-success ml-10">{{ nums.4 }}</span></a>
                                        </li>

                                        <li id="Postcode">
                                            <a href="#"> Postcode<span
                                                    class="label label-info ml-10">{{ nums.5 }}</span></a>
                                        </li>

                                        <li>
                                            <a href="#"> Cleaning Requests<span
                                                    class="label label-warning ml-10">On hold</span></a>
                                        </li>
                                        <li>
                                            <a href="#"> Recycling Requests<span
                                                    class="label label-warning ml-10">On hold</span></a>
                                        </li>
                                    </ul>

                                </aside>

                                <aside class="col-lg-10 col-md-8 pl-0">
                                    <div class="panel pa-0">
                                        <div class="panel-wrapper collapse in">
                                            <div class="panel-body  pa-0">
                                                <div class="table-responsive mb-30">
                                                    <table id="datable_1" class="table  display table-hover mb-30"
                                                           data-page-size="10">
                                                        <thead>

                                                        <tr>
                                                            {% if type == "Emp" %}
                                                                <th>No</th>
                                                                <th>Name</th>
                                                                <th>Phone</th>
                                                                <th>Gender</th>
                                                                <th>Country</th>
                                                                <th>Enroll Date</th>
                                                            {% elif type == "Worker" %}
                                                                <th>No</th>
                                                                <th>Name</th>
                                                                <th>Phone</th>
                                                                <th>Country</th>
                                                                <th>Enroll Date</th>
                                                                <th>Is Available <input
                                                                        onclick="setAvailability('Worker')"
                                                                        id="WorkerIsAvailable" type="checkbox"
                                                                        {% if  isCheckedWorker %} checked {% endif %}>
                                                                </th>
                                                            {% elif type == "Truck" %}
                                                                <th>No</th>
                                                                <th>Plate Number</th>
                                                                <th>Miles</th>
                                                                <th>Type</th>
                                                                <th>Odometer</th>
                                                                <th>Model</th>
                                                                <th>Enroll Date</th>
                                                                <th>Is Available <input
                                                                        onclick="setAvailability('Truck')"
                                                                        id="TruckIsAvailable" type="checkbox"
                                                                        {% if  isCheckedTruck %} checked {% endif %}>
                                                                </th>
                                                            {% elif type == "User" %}
                                                                <th>No</th>
                                                                <th>Phone</th>
                                                                <th>Points</th>
                                                            {% elif type == "QR" %}
                                                                <th>No</th>
                                                                <th>ID</th>
                                                                <th>Lat</th>
                                                                <th>Lng</th>
                                                                <th>PostCode</th>
                                                                <th>Request Count</th>
                                                                <th>QRcode</th>
                                                                <th style="text-align: center">QR Image</th>
                                                            {% elif type == "Postcode" %}
                                                                <th>No</th>
                                                                <th>Postcode</th>
                                                                <th>Total Container</th>
                                                                <th>Total Scanned Container</th>
                                                            {% endif %}
                                                        </tr>

                                                        </thead>
                                                        <tbody>
                                                        {% if type == "Emp" %}
                                                            {% for i in Entity %}
                                                                <tr>
                                                                    <td>{{ forloop.counter }}</td>
                                                                    <td><a href="#">{{ i.full_name }}</a></td>
                                                                    <td>{{ i.phone_number }}</td>
                                                                    <td>{{ i.gender }}</td>
                                                                    <td>{{ i.country }}
                                                                    </td>
                                                                    <td>{{ i.enrol_date }}</td>
                                                                </tr>
                                                            {% endfor %}
                                                        {% elif type == "Worker" %}

                                                            {% for i in Entity %}
                                                                <tr>
                                                                    <td>{{ forloop.counter }}</td>
                                                                    <td><a href="#">{{ i.full_name }}</a></td>
                                                                    <td>{{ i.phone_number }}</td>
                                                                    <td>{{ i.country }}</td>
                                                                    <td>{{ i.enrol_date }}
                                                                    </td>
                                                                    <td><input
                                                                            onclick="CheckboxClick('Worker','W'+'{{ forloop.counter }}')"
                                                                            type="checkbox" {% if i.isAvailable %}
                                                                            checked {% endif %}></td>
                                                                </tr>
                                                            {% endfor %}
                                                        {% elif type == "Truck" %}

                                                            {% for i in Entity %}
                                                                <tr>
                                                                    <td>{{ forloop.counter }}</td>
                                                                    <td><a href="#">{{ i.plate_num }}</a></td>
                                                                    <td>{{ i.miles }}</td>
                                                                    <td>{{ i.veh_type }}</td>
                                                                    <td>{{ i.odometer }}</td>
                                                                    <td>{{ i.veh_model }}</td>
                                                                    <td>{{ i.enrol_date }}</td>
                                                                    <td><input
                                                                            onclick="CheckboxClick('Truck','T'+'{{ forloop.counter }}')"
                                                                            id="truckCheckbox" type="checkbox"
                                                                            {% if i.isAvailable %} checked {% endif %}>
                                                                    </td>
                                                                </tr>
                                                            {% endfor %}
                                                        {% elif type == "User" %}

                                                            {% for i in Entity %}
                                                                <tr>
                                                                    <td>{{ forloop.counter }}</td>
                                                                    <td><a href="#">{{ i.phone_number }}</a></td>
                                                                    <td>{{ i.points }}</td>
                                                                </tr>
                                                            {% endfor %}

                                                        {% elif type == "QR" %}

                                                            {% for i,n in Entity %}
                                                                <tr>
                                                                    <td style="text-align: center">{{ forloop.counter }}</td>
                                                                    <td style="text-align: center">{{ i.id }}</td>
                                                                    {#                                                                    <td>{{ i.lat }}</td>#}
                                                                    {#                                                                    <td>{{ i.lng }}</td>#}
                                                                    <td>{% if i.lat == -1.0 %} None {% else %}
                                                                        {{ i.lat }}{% endif %}</td>
                                                                    <td>{% if i.lng == -1.0 %} None {% else %}
                                                                        {{ i.lng }}{% endif %}</td>
                                                                    <td style="text-align: center">{{ i.post_code__post_code }}</td>
                                                                    <td style="text-align: center">{{ i.request_count }}</td>
                                                                    <td>{{ i.QRcode }}</td>
                                                                    <td style="text-align: center">
                                                                        <svg role="img">{{ n|safe }}</svg>
                                                                    </td>
                                                                </tr>
                                                            {% endfor %}
                                                        {% elif type == "Postcode" %}
                                                            {% for i,scanCont in Entity %}
                                                                <tr>
                                                                    <td>{{ forloop.counter }}</td>
                                                                    <td>{{ i.post_code }}</td>
                                                                    <td>{{ i.contCount }}</td>
                                                                    <td>{{ scanCont }}</td>
                                                                </tr>
                                                            {% endfor %}
                                                        {% endif %}
                                                        </tbody>
                                                    </table>
                                                </div>
                                             {% if type == "QR" %}
                                                <div style="margin-right: 1%" align="right">
                                                    <a style="font-size: medium" href="{% url 'printQR' %}"><i class="zmdi zmdi-print"></i><span> Print QR</span></a>
                                                </div>
                                            {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </aside>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% if type == "QR" %}
        <div class="row">
            <div class="col-sm-12">
                <div class="panel panel-default card-view">
                    <div class="panel-heading">
                        <div class="pull-left">
                            <h6 class="panel-title txt-dark">Container Generation</h6>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="panel-wrapper collapse in">
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                                    <label class="control-label">Number of Containers</label>
                                    <input type="text" id="contGenField" class="form-control"
                                           placeholder="Ex: 3" name="id" value="3">
                                    <span class="help-block"> Number of Containers to Generate. </span>
                                </div>

                                <div style="margin-top: 0.2in;" class="col-lg-3 col-md-3 col-sm-12 col-xs-12" id="contDiv">
                                    <button type="button" id="genCont" onclick="generateContainer()"
                                            class="btn btn-info btn-anim"><i
                                            class="fa fa-qrcode"></i><span
                                            class="btn-text">Generate Containers</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}


    <script>
        async function setAvailability(type) {
            var status = null;

            if ("Truck" == type) {
                if (document.getElementById("TruckIsAvailable").checked)
                    status = true
                else
                    status = false

                await sendRequestByAjax("invertTruckIsChecked");
            } else if ("Worker") {
                if (document.getElementById("WorkerIsAvailable").checked)
                    status = true
                else
                    status = false
                await sendRequestByAjax("invertWorkerIsChecked");
            }

            let obj = {
                'entType': type,
                'status': status
            }

            await sendJsonByAjax(obj, "setAvailability")
        }

        async function generateContainer() {
            var containerCount = document.getElementById("contGenField").value;

            let obj = {
                count: containerCount,
            }

            await sendJsonByAjax(obj, "generateContainers");

        }


        async function CheckboxClick(type, id) {
            let obj = {
                'entType': type,
                'ID': id
            }

            await sendJsonByAjax(obj, "setAvailabilityByEntity")
        }

        async function sendJsonByAjax(jsonObj, functionName) {
            var serializedData = JSON.stringify(jsonObj);
            $j.ajax({
                type: "POST",
                url: "ajax/post/" + functionName + "/",
                data: {
                    csrfmiddlewaretoken: "{{ csrf_token }}",
                    serializedData
                },
                success: function (data) {
                    document.location.reload(true)
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }

        async function sendRequestByAjax(functionName) {
            $j.ajax({
                type: "POST",
                url: "ajax/request/" + functionName + "/",
                data: {csrfmiddlewaretoken: "{{ csrf_token }}"},
                success: function (data) {
                    //console.log(data)
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }

        $j(document).ready(function () {

            $("#Emp").click(function () {
                getArcData("Emp")
            });

            $("#Worker").click(function () {
                getArcData("Worker")
            });

            $("#Truck").click(function () {
                getArcData("Truck")
            });

            $("#User").click(function () {
                getArcData("User")
            });

            $("#QR").click(function () {
                getArcData("QR")
            });

            $("#Postcode").click(function () {
                getArcData("Postcode")
            });


            async function sendJsonByAjax(jsonObj, functionName) {
                var serializedData = JSON.stringify(jsonObj);
                $.ajax({
                    type: "POST",
                    url: "ajax/post/" + functionName + "/",
                    data: {
                        csrfmiddlewaretoken: "{{ csrf_token }}",
                        serializedData
                    },
                    success: function (data) {
                        document.location.reload(true)
                    },
                    error: function (error) {
                        console.log(error);
                    }
                });
            }

            async function getArcData(type) {
                let obj = {
                    'entType': type,
                }
                await sendJsonByAjax(obj, "updateComCenSelected")
            }

        });
    </script>
{% endblock content %}